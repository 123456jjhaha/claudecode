# å·¥ä½œç©ºé—´éš”ç¦»ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ç®€ä»‹

å·¥ä½œç©ºé—´éš”ç¦»ç³»ç»Ÿä¸ºæ¯ä¸ª session è‡ªåŠ¨åˆ›å»ºç‹¬ç«‹çš„å·¥ä½œç›®å½•ï¼Œè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š
- âœ“ é¿å…å¤šä¸ª session çš„æ–‡ä»¶æ“ä½œç›¸äº’æ±¡æŸ“
- âœ“ æ–¹ä¾¿è¿½è¸ªæ¯ä¸ª session äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶
- âœ“ æ”¯æŒæ‰‹åŠ¨æ¸…ç†è¿‡æœŸå·¥ä½œç›®å½•
- âœ“ è‡ªåŠ¨å‘ŠçŸ¥ Claude å…¶ä¸“å±å·¥ä½œç›®å½•

**æ³¨æ„**ï¼šå·¥ä½œç©ºé—´åŠŸèƒ½æ˜¯å¼ºåˆ¶å¯ç”¨çš„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ª session åˆ›å»ºç‹¬ç«‹çš„å·¥ä½œç›®å½•ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®å·¥ä½œç©ºé—´

åœ¨ `config.yaml` ä¸­é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š

```yaml
workspace:
  auto_create: true           # è‡ªåŠ¨åˆ›å»ºå·¥ä½œç›®å½•
  init_message: true          # åœ¨ system prompt ä¸­å‘ŠçŸ¥ Claude
  retention_days: 30          # ä¿ç•™ 30 å¤©
```

### 2. ç›®å½•ç»“æ„

æ¯ä¸ª session çš„å·¥ä½œç›®å½•å›ºå®šä½äºï¼š

```
instances/{instance_name}/sessions/{session_id}/workspace/
â”œâ”€â”€ .workspace_info.json    # å·¥ä½œç©ºé—´å…ƒæ•°æ®
â””â”€â”€ ...                     # Claude åˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶
```

### 3. Claude çœ‹åˆ°çš„ä¿¡æ¯

å½“ `init_message: true` æ—¶ï¼ŒClaude ä¼šåœ¨ system prompt ä¸­æ”¶åˆ°ï¼š

```
## Your Workspace

Your dedicated workspace directory is: `instances/demo_agent/sessions/20251221.../workspace`

- This is YOUR isolated workspace for this conversation
- All files you create should go here unless explicitly directed otherwise
- The workspace will be preserved for 30 days
```

## é…ç½®é€‰é¡¹

### æ ¸å¿ƒé…ç½®

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `auto_create` | bool | `true` | æ˜¯å¦è‡ªåŠ¨åˆ›å»ºå·¥ä½œç›®å½• |
| `init_message` | bool | `true` | æ˜¯å¦åœ¨ system prompt ä¸­å‘ŠçŸ¥å·¥ä½œç›®å½• |
| `retention_days` | int | `30` | å·¥ä½œç›®å½•ä¿ç•™å¤©æ•°ï¼ˆä¾›æ¸…ç†å·¥å…·å‚è€ƒï¼‰ |

### å¯é€‰é…ç½®

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `max_size_mb` | int | `500` | å•ä¸ªå·¥ä½œç›®å½•æœ€å¤§å¤§å°ï¼ˆMBï¼‰ |
| `warn_size_mb` | int | `400` | è­¦å‘Šé˜ˆå€¼ï¼ˆMBï¼‰ |
| `init_message_template` | str | é»˜è®¤æ¨¡æ¿ | è‡ªå®šä¹‰ system prompt æ¶ˆæ¯æ¨¡æ¿ |

### è‡ªå®šä¹‰æ¶ˆæ¯æ¨¡æ¿

```yaml
workspace:
  init_message_template: |
    # ğŸ¯ ä½ çš„ä¸“å±å·¥ä½œç©ºé—´

    **å·¥ä½œç›®å½•**: `{workspace_path}`

    è¯·å°†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶å’Œè¾“å‡ºæ–‡ä»¶ä¿å­˜åˆ°è¿™ä¸ªç›®å½•ã€‚
    æ­¤å·¥ä½œç©ºé—´å°†ä¿ç•™ {retention_days} å¤©ã€‚
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```python
import asyncio
from src import AgentSystem

async def main():
    # åˆ›å»º Agentï¼ˆè‡ªåŠ¨å¯ç”¨å·¥ä½œç©ºé—´ï¼‰
    agent = AgentSystem("demo_agent")
    await agent.initialize()

    # æ‰§è¡ŒæŸ¥è¯¢
    result = await agent.query_text(
        "è¯·åœ¨ä½ çš„å·¥ä½œç›®å½•åˆ›å»ºä¸€ä¸ª hello.txt æ–‡ä»¶ï¼Œå†…å®¹ä¸º 'Hello World'"
    )

    print(f"Session ID: {result.session_id}")

    # æŸ¥çœ‹å·¥ä½œç›®å½•
    if agent.workspace_manager:
        workspace_path = agent.workspace_manager.get_workspace_path(result.session_id)
        print(f"å·¥ä½œç›®å½•: {workspace_path}")

        # æ£€æŸ¥æ–‡ä»¶
        hello_file = workspace_path / "hello.txt"
        if hello_file.exists():
            print(f"âœ“ æ–‡ä»¶å·²åˆ›å»º: {hello_file.read_text()}")

    agent.cleanup()

asyncio.run(main())
```

### Resume ä¼šè¯

Resume ä¼šè¯æ—¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨åŸå·¥ä½œç›®å½•ï¼š

```python
# ç¬¬ä¸€æ¬¡æŸ¥è¯¢
result1 = await agent.query_text("åˆ›å»º data.txt")

# Resume ä¼šè¯ï¼ˆä½¿ç”¨åŒä¸€ä¸ªå·¥ä½œç›®å½•ï¼‰
result2 = await agent.query_text(
    "è¯»å– data.txt çš„å†…å®¹",
    resume_session_id=result1.session_id
)
```

## æ¸…ç†å·¥ä½œç›®å½•

### æ‰‹åŠ¨æ¸…ç†

ä½¿ç”¨æ¸…ç†å·¥å…·è„šæœ¬ï¼š

```bash
# æ¸…ç†è¶…è¿‡ 30 å¤©çš„å·¥ä½œç›®å½•ï¼ˆä½¿ç”¨é…ç½®å€¼ï¼‰
python scripts/cleanup_workspaces.py demo_agent

# æ¸…ç†è¶…è¿‡ 7 å¤©çš„å·¥ä½œç›®å½•ï¼ˆè¦†ç›–é…ç½®ï¼‰
python scripts/cleanup_workspaces.py demo_agent --days=7

# é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…åˆ é™¤ï¼‰
python scripts/cleanup_workspaces.py demo_agent --dry-run
```

### æ¸…ç†æŠ¥å‘Š

æ¸…ç†å®Œæˆåä¼šæ˜¾ç¤ºï¼š

```
å·¥ä½œç©ºé—´æ¸…ç†å·¥å…·
============================================================
å®ä¾‹: demo_agent
ä¿ç•™å¤©æ•°: 30
æ¨¡å¼: æ‰§è¡Œ
============================================================

æ¸…ç†å®Œæˆï¼

æ‰«æ: 50 ä¸ªå·¥ä½œç›®å½•
åˆ é™¤: 15 ä¸ª
å¤±è´¥: 0 ä¸ª
é‡Šæ”¾ç©ºé—´: 234.56 MB

å·²åˆ é™¤çš„ä¼šè¯:
  - 20251101T100000_1000_abc123 (å¹´é¾„: 35 å¤©, å¤§å°: 12.34 MB)
  - 20251102T120000_1001_def456 (å¹´é¾„: 32 å¤©, å¤§å°: 8.90 MB)
  ...
```

## æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

1. **ä¸æ”¯æŒè‡ªåŠ¨æ¸…ç†**ï¼šä¸ºäº†å®‰å…¨ï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨åˆ é™¤å·¥ä½œç›®å½•ï¼Œå¿…é¡»æ‰‹åŠ¨è¿è¡Œæ¸…ç†å·¥å…·
2. **è°¨æ…ä½¿ç”¨ --days å‚æ•°**ï¼šç¡®ä¿ä¸ä¼šè¯¯åˆ é‡è¦æ–‡ä»¶

### æ€§èƒ½

1. **å·¥ä½œç›®å½•åˆ›å»º**ï¼šåœ¨æ¯æ¬¡æŸ¥è¯¢å¼€å§‹æ—¶åˆ›å»ºï¼Œæ€§èƒ½å½±å“æå°ï¼ˆ< 10msï¼‰
2. **Resume æ€§èƒ½**ï¼šResume ä¼šè¯æ—¶ä¸ä¼šåˆ›å»ºæ–°ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨åŸç›®å½•

## å¸¸è§é—®é¢˜

### Q: Claude è¿˜èƒ½è®¿é—®å…¶ä»–ç›®å½•å—ï¼Ÿ

A: å¯ä»¥ã€‚workspace åªæ˜¯æ”¹å˜äº† `cwd`ï¼ˆå½“å‰å·¥ä½œç›®å½•ï¼‰å’Œåœ¨ system prompt ä¸­å»ºè®® Claude ä½¿ç”¨å·¥ä½œç›®å½•ï¼Œä½†ä¸é™åˆ¶ Claude è®¿é—®å…¶ä»–è·¯å¾„ã€‚

### Q: å·¥ä½œç›®å½•ä¼šè‡ªåŠ¨æ¸…ç†å—ï¼Ÿ

A: ä¸ä¼šã€‚å¿…é¡»æ‰‹åŠ¨è¿è¡Œæ¸…ç†å·¥å…·è„šæœ¬ï¼ˆ`scripts/cleanup_workspaces.py`ï¼‰ã€‚

### Q: Resume ä¼šè¯ä¼šåˆ›å»ºæ–°çš„å·¥ä½œç›®å½•å—ï¼Ÿ

A: ä¸ä¼šã€‚Resume ä¼šè¯æ—¶ä½¿ç”¨åŸ session çš„å·¥ä½œç›®å½•ã€‚

### Q: å·¥ä½œç›®å½•çš„å…ƒæ•°æ®æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ

A: `.workspace_info.json` æ–‡ä»¶åŒ…å«å·¥ä½œç›®å½•çš„åˆ›å»ºæ—¶é—´ã€ä¿ç•™å¤©æ•°ç­‰ä¿¡æ¯ï¼Œä¾›æ¸…ç†å·¥å…·ä½¿ç”¨ã€‚

## æœ€ä½³å®è·µ

1. **å®šæœŸæ¸…ç†**ï¼šå»ºè®®æ¯æœˆè¿è¡Œä¸€æ¬¡æ¸…ç†å·¥å…·ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´
2. **ä¿ç•™å¤©æ•°è®¾ç½®**ï¼šæ ¹æ®å®é™…éœ€æ±‚è®¾ç½® `retention_days`ï¼Œå»ºè®® 7-30 å¤©
3. **ç›‘æ§å¤§å°**ï¼šå®šæœŸæ£€æŸ¥å·¥ä½œç›®å½•å¤§å°ï¼Œé¿å…å ç”¨è¿‡å¤šç©ºé—´
4. **è‡ªå®šä¹‰æ¶ˆæ¯**ï¼šå¯ä»¥é€šè¿‡ `init_message_template` è‡ªå®šä¹‰å‘ŠçŸ¥ Claude çš„æ¶ˆæ¯

## å‚è€ƒ

- [è®¾è®¡æ–‡æ¡£](../workspace_design.md) - å®Œæ•´çš„è®¾è®¡æ€è·¯å’Œæ¶æ„è¯´æ˜
- [é…ç½®æŒ‡å—](./configuration.md) - å®Œæ•´çš„é…ç½®é€‰é¡¹è¯´æ˜
- [ä¼šè¯ç³»ç»ŸæŒ‡å—](./session-guide.md) - ä¼šè¯ç®¡ç†å®Œæ•´æŒ‡å—
